---
title: Middleware
description: Intercepte e modifique requisiÃ§Ãµes e respostas no AzuraJS
category: Conceitos Principais
icon: lucide:plug
order: 4
---

# Middleware ğŸ”Œ

Middleware sÃ£o funÃ§Ãµes que tÃªm acesso aos objetos de requisiÃ§Ã£o (`req`), resposta (`res`) e Ã  prÃ³xima funÃ§Ã£o de middleware no ciclo de requisiÃ§Ã£o-resposta de uma aplicaÃ§Ã£o AzuraJS. Eles podem executar cÃ³digo, fazer alteraÃ§Ãµes nos objetos de requisiÃ§Ã£o e resposta, finalizar o ciclo de requisiÃ§Ã£o-resposta ou chamar o prÃ³ximo middleware.

## Como Funciona o Middleware

Cada funÃ§Ã£o de middleware recebe trÃªs argumentos:

1.  `req`: O objeto de requisiÃ§Ã£o (`RequestServer`).
2.  `res`: O objeto de resposta (`ResponseServer`).
3.  `next`: Uma funÃ§Ã£o que, quando chamada, executa o prÃ³ximo middleware na pilha.

```typescript
import type { RequestServer, ResponseServer } from "azurajs/types";

const loggerMiddleware = (req: RequestServer, res: ResponseServer, next: () => Promise<void>) => {
  console.log(`RequisiÃ§Ã£o recebida: ${req.method} ${req.url}`);
  next(); // Chama o prÃ³ximo middleware ou o handler da rota
};
```

## Registrando Middleware

VocÃª pode registrar middleware globalmente para todas as rotas ou especificamente para um controller ou rota.

### Globalmente

Use o mÃ©todo `app.use()` para aplicar middleware a todas as requisiÃ§Ãµes.

```typescript
import { AzuraClient } from "azurajs";

const app = new AzuraClient();

app.use(loggerMiddleware);
app.use(anotherMiddleware);

// ... registre controllers e inicie o servidor
```

### Por Controller

VocÃª pode aplicar middleware a um controller inteiro usando o decorator `@UseMiddleware`.

```typescript
import { Controller, Get, UseMiddleware } from "azurajs/decorators";
import type { RequestServer, ResponseServer } from "azurajs/types";

const authMiddleware = (req: RequestServer, res: ResponseServer, next: () => Promise<void>) => {
  if (!req.headers.authorization) {
    return res.status(401).send("NÃ£o autorizado");
  }
  next();
};

@UseMiddleware(authMiddleware)
@Controller("/admin")
export class AdminController {
  @Get("/dashboard")
  getDashboard() {
    return "Painel de AdministraÃ§Ã£o";
  }
}
```

### Por Rota

O decorator `@UseMiddleware` tambÃ©m pode ser aplicado a mÃ©todos de rota especÃ­ficos.

```typescript
import { Controller, Get, UseMiddleware } from "azurajs/decorators";

const logTimeMiddleware = (req: RequestServer, res: ResponseServer, next: () => Promise<void>) => {
  const start = Date.now();
  res.on("finish", () => {
    console.log(`RequisiÃ§Ã£o ${req.url} levou ${Date.now() - start}ms`);
  });
  next();
};

@Controller("/data")
export class DataController {
  @UseMiddleware(logTimeMiddleware)
  @Get("/heavy-report")
  getHeavyReport() {
    // ... lÃ³gica que pode demorar
    return "RelatÃ³rio pesado";
  }
}
```

## Middleware AssÃ­ncrono

Middleware podem ser funÃ§Ãµes assÃ­ncronas. Certifique-se de usar `await next()` para garantir que o prÃ³ximo middleware ou handler de rota seja executado e que a resposta seja aguardada.

```typescript
const asyncMiddleware = async (req, res, next) => {
  await someAsyncOperation();
  await next();
};
```

## PrÃ³ximos Passos ğŸ“–

- [âš™ï¸ **ConfiguraÃ§Ã£o**](/docs/pt/framework/comecando/configuracao): Veja como configurar middlewares globais via `azura.config.ts`.
- [ğŸš¨ **Tratamento de Erros**](/docs/pt/framework/recursos/error-handling): Entenda como middlewares de erro podem ser usados para centralizar o tratamento de exceÃ§Ãµes.
