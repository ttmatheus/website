---
title: Middleware
description: Intercepte e modifique requisiÃ§Ãµes e respostas no AzuraJS
category: Conceitos Principais
icon: lucide:plug
order: 4
---

# Middleware ğŸ”Œ

As funÃ§Ãµes de middleware sÃ£o parte fundamental do ciclo de requisiÃ§Ã£o-resposta no AzuraJS. Elas tÃªm acesso ao `RequestServer`, `ResponseServer` e Ã  funÃ§Ã£o `next`, permitindo executar cÃ³digo, transformar dados ou encerrar a requisiÃ§Ã£o antes que ela chegue ao manipulador da rota.

## Como Funciona o Middleware

Uma funÃ§Ã£o de middleware tipicamente executa uma das seguintes tarefas:

- Executa cÃ³digo arbitrÃ¡rio.
- Modifica os objetos de requisiÃ§Ã£o ou resposta.
- Encerra o ciclo de requisiÃ§Ã£o-resposta (ex: enviando uma resposta antecipada).
- Chama `next()` para passar o controle para o prÃ³ximo middleware na pilha.

Cada middleware recebe trÃªs argumentos:

1.  `req`: O objeto de requisiÃ§Ã£o (`RequestServer`).
2.  `res`: O objeto de resposta (`ResponseServer`).
3.  `next`: O callback para continuar a execuÃ§Ã£o.

```typescript
import type { RequestServer, ResponseServer } from "azurajs/types";

const loggerMiddleware = (
  req: RequestServer,
  res: ResponseServer,
  next: () => Promise<void>,
) => {
  console.log(`RequisiÃ§Ã£o recebida: ${req.method} ${req.url}`);
  next();
};
```

## Registrando Middleware

Middleware pode ser aplicado em diferentes escopos: globalmente, por controller ou por rota.

### Middleware Global

Para aplicar middleware a todas as requisiÃ§Ãµes, registre-o usando o mÃ©todo `app.use()`.

```typescript
import { AzuraClient } from "azurajs";

const app = new AzuraClient();

app.use(loggerMiddleware);
app.use(anotherMiddleware);
```

### Middleware de Controller

Use o decorator `@UseMiddleware` para aplicar middleware a todas as rotas dentro de um controller.

```typescript
import { Controller, Get, UseMiddleware } from "azurajs/decorators";
import type { RequestServer, ResponseServer } from "azurajs/types";

const authMiddleware = (
  req: RequestServer,
  res: ResponseServer,
  next: () => Promise<void>,
) => {
  if (!req.headers.authorization) {
    return res.status(401).send("NÃ£o autorizado");
  }
  next();
};

@UseMiddleware(authMiddleware)
@Controller("/admin")
export class AdminController {
  @Get("/dashboard")
  getDashboard() {
    return "Painel de AdministraÃ§Ã£o";
  }
}
```

### Middleware de Rota

O decorator `@UseMiddleware` tambÃ©m pode direcionar mÃ©todos individuais para aplicar middleware seletivamente.

```typescript
import { Controller, Get, UseMiddleware } from "azurajs/decorators";

const logTimeMiddleware = (
  req: RequestServer,
  res: ResponseServer,
  next: () => Promise<void>,
) => {
  const start = Date.now();
  res.on("finish", () => {
    console.log(`RequisiÃ§Ã£o ${req.url} levou ${Date.now() - start}ms`);
  });
  next();
};

@Controller("/data")
export class DataController {
  @UseMiddleware(logTimeMiddleware)
  @Get("/heavy-report")
  getHeavyReport() {
    return "RelatÃ³rio pesado";
  }
}
```

## Middleware AssÃ­ncrono

FunÃ§Ãµes de middleware suportam totalmente `async/await`. Sempre aguarde `next()` se precisar executar aÃ§Ãµes apÃ³s a conclusÃ£o do middleware subsequente ou se a ordem de execuÃ§Ã£o for crÃ­tica.

```typescript
const asyncMiddleware = async (req, res, next) => {
  await someAsyncOperation();
  await next();
};
```

## PrÃ³ximos Passos ğŸ“–

- [âš™ï¸ **ConfiguraÃ§Ã£o**](/docs/pt/framework/comecando/configuracao): Veja como configurar middlewares globais via `azura.config.ts`.
- [ğŸš¨ **Tratamento de Erros**](/docs/pt/framework/recursos/error-handling): Entenda como middlewares de erro podem ser usados para centralizar o tratamento de exceÃ§Ãµes.
