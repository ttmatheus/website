---
title: Proxy
description: Crie um proxy reverso de alta performance com AzuraJS
category: Recursos
icon: lucide:globe
order: 5
---

# Proxy üåê

O AzuraJS oferece um middleware de proxy reverso que permite encaminhar requisi√ß√µes para outros servidores. Isso √© √∫til para unificar APIs, contornar pol√≠ticas de CORS ou balancear carga entre diferentes servi√ßos. O plugin de proxy √© altamente configur√°vel e pode ser usado tanto no `azurajs` quanto no `@azurajs/cdn`.

## Configura√ß√£o B√°sica

Voc√™ pode usar o middleware `proxyPlugin` diretamente em seu `AzuraClient`:

```typescript
import { AzuraClient } from "azurajs";
import { proxyPlugin } from "azurajs/plugins";

const app = new AzuraClient();

// Encaminha todas as requisi√ß√µes para /api para um servidor de backend
app.use("/api", proxyPlugin("http://localhost:8080"));

await app.listen(3000);
```

## Op√ß√µes de Proxy

O `proxyPlugin` aceita um objeto de op√ß√µes para um controle mais granular:

```typescript
import { AzuraClient } from "azurajs";
import { proxyPlugin } from "azurajs/plugins";

const app = new AzuraClient();

app.use("/api", proxyPlugin("http://localhost:8080", {
  pathRewrite: {
    "^/api": "/"
  }, // Reescreve o caminho da URL
  headers: {
    "X-Custom-Header": "AzuraJS-Proxy"
  }, // Adiciona cabe√ßalhos personalizados
  timeout: 5000, // Tempo limite da requisi√ß√£o em ms
  followRedirects: false, // N√£o seguir redirecionamentos
  preserveHost: true, // Preservar o cabe√ßalho Host original
  logLevel: "debug", // N√≠vel de log do proxy (info, warn, error, debug, none)
  onProxyReq: (proxyReq, req) => {
    // Modificar a requisi√ß√£o antes de enviar ao target
    proxyReq.setHeader("X-Real-IP", req.ip);
  },
  onProxyRes: (proxyRes, req, res) => {
    // Modificar a resposta do target antes de enviar ao cliente
    proxyRes.headers["x-proxied-by"] = "AzuraJS";
  },
  onError: (err, req, res) => {
    // Lidar com erros de proxy
    res.status(500).json({ error: "Proxy Error", details: err.message });
  }
}));

await app.listen(3000);
```

### Detalhes das Op√ß√µes

| Op√ß√£o | Tipo | Descri√ß√£o |
| :--- | :--- | :--- |
| `target` | `string` | **Obrigat√≥rio**. A URL base do servidor de destino. |
| `pathRewrite` | `Record<string, string>` | Um objeto para reescrever o caminho da URL antes de encaminhar. As chaves s√£o regex e os valores s√£o strings de substitui√ß√£o. |
| `headers` | `Record<string, string>` | Cabe√ßalhos adicionais a serem enviados para o servidor de destino. |
| `timeout` | `number` | Tempo limite em milissegundos para a requisi√ß√£o proxy. Padr√£o: `30000` (30 segundos). |
| `followRedirects` | `boolean` | Se `true`, o proxy seguir√° redirecionamentos do servidor de destino. Padr√£o: `false`. |
| `preserveHost` | `boolean` | Se `true`, o cabe√ßalho `Host` original da requisi√ß√£o do cliente ser√° enviado ao destino. Padr√£o: `false`. |
| `logLevel` | `"info" \| "warn" \| "error" \| "debug" \| "none"` | N√≠vel de detalhe dos logs do proxy. Padr√£o: `"info"`. |
| `onProxyReq` | `(proxyReq, req) => void` | Fun√ß√£o de callback chamada antes de enviar a requisi√ß√£o ao destino. Permite modificar `proxyReq`. |
| `onProxyRes` | `(proxyRes, req, res) => void` | Fun√ß√£o de callback chamada ap√≥s receber a resposta do destino. Permite modificar `proxyRes` ou `res`. |
| `onError` | `(err, req, res) => void` | Fun√ß√£o de callback para lidar com erros que ocorrem durante a requisi√ß√£o proxy. |

## Pr√≥ximos Passos üìñ

- [‚ö° **Modo Cluster**](/docs/pt/framework/recursos/cluster-mode): Combine o proxy com o modo cluster para alta disponibilidade.
- [üåê **CORS**](/docs/pt/framework/recursos/cors): Use o proxy para resolver problemas de CORS entre diferentes origens.
