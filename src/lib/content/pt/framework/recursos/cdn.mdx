---
title: AzuraJS CDN
description: Gerencie cache, URLs assinadas e purga de CDN com AzuraJS
category: Recursos
icon: lucide:cloud
order: 9
---

# AzuraJS CDN ‚òÅÔ∏è

O `@azurajs/cdn` √© um pacote complementar ao AzuraJS que oferece funcionalidades para integra√ß√£o e gerenciamento de redes de entrega de conte√∫do (CDN). Ele simplifica tarefas como a gera√ß√£o de URLs assinadas para acesso seguro a recursos privados e a purga de cache para garantir que o conte√∫do mais recente seja sempre entregue.

## Instala√ß√£o

Instale o pacote `@azurajs/cdn` no seu projeto:

<Tabs items={["npm", "pnpm", "yarn", "bun"]}>
  <Tab value="npm">
```bash
npm install @azurajs/cdn
```
  </Tab>
  <Tab value="pnpm">
```bash
pnpm add @azurajs/cdn
```
  </Tab>
  <Tab value="yarn">
```bash
yarn add @azurajs/cdn
```
  </Tab>
  <Tab value="bun">
```bash
bun add @azurajs/cdn
```
  </Tab>
</Tabs>

## Configura√ß√£o

Voc√™ pode configurar o CDN no seu `azura.config.ts`:

```typescript
// azura.config.ts
import type { ConfigTypes } from "azurajs/config";

const config: ConfigTypes = {
  // ...
  cdn: {
    provider: "cloudflare", // ou "aws-s3", "azure-blob", etc.
    apiKey: process.env.CDN_API_KEY, // Chave da API do seu provedor CDN
    domain: "cdn.seusite.com", // Dom√≠nio do seu CDN
    // Configura√ß√µes espec√≠ficas do provedor
    cloudflare: {
      zoneId: process.env.CLOUDFLARE_ZONE_ID,
      email: process.env.CLOUDFLARE_EMAIL,
    },
    // ...
  },
};

export default config;
```

## Gera√ß√£o de URLs Assinadas

URLs assinadas permitem que voc√™ conceda acesso tempor√°rio e seguro a recursos privados armazenados no seu CDN, sem expor o bucket ou a chave de acesso. O `@azurajs/cdn` oferece um servi√ßo para gerar essas URLs.

```typescript
import { Controller, Get, Query } from "azurajs/decorators";
import { AzuraCDN } from "@azurajs/cdn";

@Controller("/files")
export class FileController {
  private cdnService: AzuraCDN;

  constructor() {
    this.cdnService = new AzuraCDN(); // Inicializa com a configura√ß√£o do azura.config.ts
  }

  @Get("/download")
  async getSignedUrl(@Query("path") filePath: string) {
    if (!filePath) {
      return { error: "Caminho do arquivo √© obrigat√≥rio" };
    }
    const signedUrl = await this.cdnService.getSignedUrl(filePath, { expiresIn: 3600 }); // Expira em 1 hora
    return { signedUrl };
  }
}
```

### Op√ß√µes de `getSignedUrl`

| Op√ß√£o | Tipo | Descri√ß√£o |
| :--- | :--- | :--- |
| `expiresIn` | `number` | Tempo de expira√ß√£o da URL em segundos. Padr√£o: `3600` (1 hora). |
| `contentType` | `string` | Tipo de conte√∫do do arquivo (ex: `image/jpeg`). |

## Purga de Cache

Quando voc√™ atualiza um recurso no seu servidor de origem, o CDN pode continuar servindo a vers√£o antiga do cache. A purga de cache for√ßa o CDN a buscar a vers√£o mais recente. O `@azurajs/cdn` facilita a purga de arquivos espec√≠ficos ou de todo o cache.

```typescript
import { Controller, Post, Body } from "azurajs/decorators";
import { AzuraCDN } from "@azurajs/cdn";

@Controller("/admin/cdn")
export class CdnAdminController {
  private cdnService: AzuraCDN;

  constructor() {
    this.cdnService = new AzuraCDN();
  }

  @Post("/purge")
  async purgeCache(@Body() body: { urls?: string[]; all?: boolean }) {
    if (body.all) {
      await this.cdnService.purgeAllCache();
      return { message: "Cache do CDN purgado com sucesso!" };
    } else if (body.urls && body.urls.length > 0) {
      await this.cdnService.purgeUrls(body.urls);
      return { message: "URLs espec√≠ficas purgadas com sucesso!" };
    }
    return { error: "Nenhuma URL ou op√ß√£o 'all' fornecida para purga." };
  }
}
```

## Pr√≥ximos Passos üìñ

- [‚öôÔ∏è **Configura√ß√£o**](/docs/pt/comecando/configuracao): Veja como configurar o objeto `cdn` no seu arquivo de configura√ß√£o.
- [üõ°Ô∏è **Rate Limiting**](/docs/pt/recursos/rate-limiting): Proteja seus endpoints de administra√ß√£o de CDN com Rate Limiting.
