---
title: Middleware
description: Intercept and modify requests and responses in AzuraJS
category: Main Concepts
icon: lucide:plug
order: 4
---

# Middleware ğŸ”Œ

Middleware are functions that have access to the request (`req`), response (`res`) objects, and the next middleware function in the request-response cycle of an AzuraJS application. They can execute code, make changes to the request and response objects, end the request-response cycle, or call the next middleware.

## How Middleware Works

Each middleware function receives three arguments:

1.  `req`: The request object (`RequestServer`).
2.  `res`: The response object (`ResponseServer`).
3.  `next`: A function that, when called, executes the next middleware in the stack.

```typescript
import type { RequestServer, ResponseServer } from "azurajs/types";

const loggerMiddleware = (req: RequestServer, res: ResponseServer, next: () => Promise<void>) => {
  console.log(`Request received: ${req.method} ${req.url}`);
  next(); // Calls the next middleware or the route handler
};
```

## Registering Middleware

You can register middleware globally for all routes or specifically for a controller or route.

### Globally

Use the `app.use()` method to apply middleware to all requests.

```typescript
import { AzuraClient } from "azurajs";

const app = new AzuraClient();

app.use(loggerMiddleware);
app.use(anotherMiddleware);

// ... register controllers and start the server
```

### Per Controller

You can apply middleware to an entire controller using the `@UseMiddleware` decorator.

```typescript
import { Controller, Get, UseMiddleware } from "azurajs/decorators";
import type { RequestServer, ResponseServer } from "azurajs/types";

const authMiddleware = (req: RequestServer, res: ResponseServer, next: () => Promise<void>) => {
  if (!req.headers.authorization) {
    return res.status(401).send("Unauthorized");
  }
  next();
};

@UseMiddleware(authMiddleware)
@Controller("/admin")
export class AdminController {
  @Get("/dashboard")
  getDashboard() {
    return "Admin Panel";
  }
}
```

### Per Route

The `@UseMiddleware` decorator can also be applied to specific route methods.

```typescript
import { Controller, Get, UseMiddleware } from "azurajs/decorators";

const logTimeMiddleware = (req: RequestServer, res: ResponseServer, next: () => Promise<void>) => {
  const start = Date.now();
  res.on("finish", () => {
    console.log(`Request ${req.url} took ${Date.now() - start}ms`);
  });
  next();
};

@Controller("/data")
export class DataController {
  @UseMiddleware(logTimeMiddleware)
  @Get("/heavy-report")
  getHeavyReport() {
    // ... logic that might take time
    return "Heavy Report";
  }
}
```

## Asynchronous Middleware

Middleware can be asynchronous functions. Make sure to use `await next()` to ensure that the next middleware or route handler is executed and the response is awaited.

```typescript
const asyncMiddleware = async (req, res, next) => {
  await someAsyncOperation();
  await next();
};
```

## Next Steps ğŸ“–

- [âš™ï¸ **Configuration**](/docs/en/getting-started/configuration): See how to configure global middlewares via `azura.config.ts`.
- [ğŸš¨ **Error Handling**](/docs/en/features/error-handling): Understand how error middlewares can be used to centralize exception handling.
